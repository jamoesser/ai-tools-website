<script>
    async function sendMessage() {
        const userInputElement = document.getElementById("userInput");
        const chatOutput = document.getElementById("chatOutput");
        const userInput = userInputElement.value.trim();
        if (!userInput) return;

        // Create user message container
        const userMessageContainer = document.createElement("div");
        userMessageContainer.className = "message-container";
        userMessageContainer.innerHTML = `<p class="message user-message"><b>You:</b> ${userInput}</p>`;
        chatOutput.appendChild(userMessageContainer);

        userInputElement.value = ""; // Clear input field

        // Create bot message container
        const botMessageContainer = document.createElement("div");
        botMessageContainer.className = "message-container";
        botMessageContainer.innerHTML = `<p class="message bot-message"><b>Bot:</b> <i>Thinking...</i></p>`;
        chatOutput.appendChild(botMessageContainer);

        // Scroll to bottom
        chatOutput.scrollTop = chatOutput.scrollHeight;

        try {
            const response = await fetch("https://api-inference.huggingface.co/models/HuggingFaceH4/zephyr-7b-alpha", {
                method: "POST",
                headers: {
                    "Authorization": "Bearer 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",  // Replace with your actual Hugging Face API key
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    inputs: userInput,
                    parameters: {
                        max_new_tokens: 100,  // Limit response length
                        temperature: 0.7,  // Control randomness (lower = more predictable)
                        top_p: 0.9  // Helps filter out unnecessary responses
                    }
                })
            });

            const data = await response.json();
            
            let botResponse = "Sorry, I couldn't understand.";
            if (data && data.generated_text) {
                botResponse = data.generated_text;
            }

            // Update bot response and remove "Thinking..."
            botMessageContainer.innerHTML = `<p class="message bot-message"><b>Bot:</b> ${botResponse}</p>`;

        } catch (error) {
            botMessageContainer.innerHTML = `<p class="message bot-message"><b>Bot:</b> Error fetching response.</p>`;
            console.error("Chatbot API error:", error);
        }

        // Scroll to bottom
        chatOutput.scrollTop = chatOutput.scrollHeight;
    }

    // Press "Enter" to send
    function handleKeyPress(event) {
        if (event.key === "Enter" && !event.shiftKey) { 
            event.preventDefault(); // Prevent new line in textarea
            sendMessage();
        }
    }
</script>
